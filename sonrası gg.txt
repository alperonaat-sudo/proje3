import cv2
import pyautogui
import numpy as np
import time

# Diğer fonksiyonları buraya ekleyin
def sol_tiklama():
    pyautogui.mouseDown(button='left')
    time.sleep(.8)  # Sol tıklama işlemi 1 saniye boyunca sürecek
    pyautogui.mouseUp(button='left')


def sol_tiklama2():
    pyautogui.mouseDown(button='left')


def sol_tiklama3():
    pyautogui.mouseUp(button='left')
    time.sleep(1.2)


def metni_ara_optimize(dosya_yolu, yazi_goruntu):
    ekran_goruntu = np.array(pyautogui.screenshot())
    ekran_goruntu_renkli = cv2.cvtColor(ekran_goruntu, cv2.COLOR_BGR2RGB)  # Renkli olarak çevirin

    sonuc = cv2.matchTemplate(ekran_goruntu_renkli, yazi_goruntu, cv2.TM_CCOEFF_NORMED)
    _, max_val, _, max_loc = cv2.minMaxLoc(sonuc)

    eşik_değeri = 0.80

    return max_val > eşik_değeri


def main():
    interval_minutes = 20  # 20 dakika aralıklarla çalışacak
    next_trigger = time.time() + interval_minutes * 60

    yazi_goruntu_1 = cv2.imread('C:/Users/nos/Desktop/ekrangg/1.png')  # Renkli olarak yükle
    yazi_goruntu_2 = cv2.imread('C:/Users/nos/Desktop/ekrangg/2.png')  # Renkli olarak yükle
    yazi_goruntu_3 = cv2.imread('C:/Users/nos/Desktop/ekrangg/a.png')  # Renkli olarak yükle

    while True:
        current_time = time.time()

        if current_time >= next_trigger:
            next_trigger = current_time + interval_minutes * 60

            pyautogui.press('a')  # 'a' tuşuna bas
            time.sleep(0.1)
            pyautogui.press('d')
            print("Tuşa basıldı!")

        if metni_ara_optimize('C:/Users/nos/Desktop/ekrangg/1.png', yazi_goruntu_1):
            sol_tiklama()
            time.sleep(0.1)

        if metni_ara_optimize('C:/Users/nos/Desktop/ekrangg/2.png', yazi_goruntu_2):
            sol_tiklama2()

        if metni_ara_optimize('C:/Users/nos/Desktop/ekrangg/a.png', yazi_goruntu_3):
            sol_tiklama3()
            time.sleep(0.5)
            while metni_ara_optimize('C:/Users/nos/Desktop/ekrangg/a.png', yazi_goruntu_3):
                sol_tiklama3()
            while not metni_ara_optimize('C:/Users/nos/Desktop/ekrangg/1.png', yazi_goruntu_1):
                sol_tiklama2()

        time.sleep(0.5)

if __name__ == '__main__':
    main()
