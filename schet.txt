import cv2
import pyautogui
import numpy as np
import time
import threading
import sched

def sol_tiklama():
    pyautogui.mouseDown(button='left')
    time.sleep(1.7)
    pyautogui.mouseUp(button='left')

def sol_tiklama2():
    pyautogui.mouseDown(button='left')

def sol_tiklama3():
    pyautogui.mouseUp(button='left')
    time.sleep(0.6)

def metni_ara(dosya_yolu, mesaj):
    yazi_goruntu = cv2.imread(dosya_yolu, cv2.IMREAD_GRAYSCALE)
    ekran_goruntu = np.array(pyautogui.screenshot())
    ekran_goruntu_gri = cv2.cvtColor(ekran_goruntu, cv2.COLOR_BGR2GRAY)
    sonuc = cv2.matchTemplate(ekran_goruntu_gri, yazi_goruntu, cv2.TM_CCOEFF_NORMED)
    _, max_val, _, max_loc = cv2.minMaxLoc(sonuc)
    eşik_değeri = 0.79
    if max_val > eşik_değeri:
        print(mesaj)
        return True
    else:
        return False

def döngü_1():
    dosya_yolu_1 = 'C:/Users/nos/Desktop/ekrangg/one.png'
    mesaj_1 = "1. görsel algılandı!"
    while True:
        if metni_ara(dosya_yolu_1, mesaj_1):
            sol_tiklama()

def döngü_2():
    dosya_yolu_2 = 'C:/Users/nos/Desktop/ekrangg/to2.png'
    mesaj_2 = "2. görsel algılandı!"
    while True:
        if metni_ara(dosya_yolu_2, mesaj_2):
            sol_tiklama2()

def döngü_3():
    dosya_yolu_33 = 'C:/Users/nos/Desktop/ekrangg/tr.png'
    mesaj_33 = "3. görsel algılandı!"
    while True:
        if metni_ara(dosya_yolu_33, mesaj_33):
            sol_tiklama3()
            time.sleep(1)
            while metni_ara(dosya_yolu_33, mesaj_33):
                sol_tiklama3()
            while not metni_ara(dosya_yolu_1, mesaj_1):
                sol_tiklama2()

def periyodik_döngü(scheduler):
    print("20 dakikada bir çalışan döngü devreye girdi!")
    # Burada 20 dakikada bir çalışması gereken işlemleri yapabilirsiniz
    # ...

    # Bir sonraki 20 dakika sonrası için döngüyü tekrar planla
    scheduler.enter(1200, 1, periyodik_döngü, (scheduler,))

if __name__ == '__main__':
    thread1 = threading.Thread(target=döngü_1)
    thread2 = threading.Thread(target=döngü_2)
    thread3 = threading.Thread(target=döngü_3)

    scheduler = sched.scheduler(time.time, time.sleep)
    scheduler.enter(0, 1, periyodik_döngü, (scheduler,))

    thread1.start()
    thread2.start()
    thread3.start()

    try:
        scheduler.run()
    except KeyboardInterrupt:
        pass

    thread1.join()
    thread2.join()
    thread3.join()
